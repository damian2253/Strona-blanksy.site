<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Surf 3D</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>
<script>
  let scene, camera, renderer, controls;
  let ramp, velocity = new THREE.Vector3();
  let gravity = -0.4, speed = 0.2;
  let onGround = false;

  init();
  animate();

  function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222222);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 10);

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Kontroler "surfowy" (Pointer Lock)
    controls = new THREE.PointerLockControls(camera, document.body);
    document.body.addEventListener('click', () => controls.lock());

    scene.add(controls.getObject());

    // Oświetlenie
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 10, 7);
    scene.add(light);

    // Rampa
    const rampGeometry = new THREE.BoxGeometry(20, 1, 100);
    const rampMaterial = new THREE.MeshStandardMaterial({color: 0x00ff88});
    ramp = new THREE.Mesh(rampGeometry, rampMaterial);
    ramp.rotation.x = -Math.PI / 12;
    ramp.position.y = 0;
    scene.add(ramp);

    // Podłoże
    const groundGeometry = new THREE.PlaneGeometry(200, 200);
    const groundMaterial = new THREE.MeshStandardMaterial({color: 0x111111});
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -10;
    scene.add(ground);

    // Ruch
    const keys = {};
    document.addEventListener('keydown', e => keys[e.code] = true);
    document.addEventListener('keyup', e => keys[e.code] = false);

    function handleMovement() {
      if (!controls.isLocked) return;

      const direction = new THREE.Vector3();
      const front = new THREE.Vector3();
      const side = new THREE.Vector3();

      controls.getDirection(front);
      front.y = 0;
      front.normalize();

      side.crossVectors(front, camera.up).normalize();

      if (keys['KeyW']) direction.add(front);
      if (keys['KeyS']) direction.sub(front);
      if (keys['KeyA']) direction.sub(side);
      if (keys['KeyD']) direction.add(side);

      direction.normalize().multiplyScalar(speed);
      velocity.x = direction.x;
      velocity.z = direction.z;

      if (onGround && keys['Space']) {
        velocity.y = 0.12;
        onGround = false;
      }
    }

    // Animacja
    function animateFrame() {
      handleMovement();

      // Grawitacja
      if (!onGround) velocity.y += gravity * 0.01;

      // Aktualizacja pozycji kamery
      controls.getObject().position.add(velocity);

      // Kolizja z rampą (bardzo uproszczona)
      const camY = controls.getObject().position.y;
      const camZ = controls.getObject().position.z;
      const rampHeightAtZ = Math.tan(Math.PI / 12) * (50 - camZ); // bo rampa idzie do przodu

      if (camZ < 50 && camZ > -50 && camY <= rampHeightAtZ + 1.5) {
        controls.getObject().position.y = rampHeightAtZ + 1.5;
        velocity.y = 0;
        onGround = true;
      } else {
        onGround = false;
      }

      renderer.render(scene, camera);
      requestAnimationFrame(animateFrame);
    }

    animate = animateFrame;
  }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>2D Surf Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #222;
    }
    canvas {
      display: block;
      background: #333;
    }
  </style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let player = {
  x: 100,
  y: 100,
  radius: 10,
  vx: 2,
  vy: 0,
  onRamp: false,
  jumpPower: -10
};

const gravity = 0.4;
const friction = 0.98;

// Rampy — linie w 2D
const ramps = [
  { x1: 50, y1: 400, x2: 300, y2: 500 },
  { x1: 350, y1: 500, x2: 600, y2: 400 },
  { x1: 650, y1: 400, x2: 800, y2: 450 },
];

function drawRamp(ramp) {
  ctx.strokeStyle = 'lime';
  ctx.lineWidth = 8;
  ctx.beginPath();
  ctx.moveTo(ramp.x1, ramp.y1);
  ctx.lineTo(ramp.x2, ramp.y2);
  ctx.stroke();
}

function drawPlayer() {
  ctx.fillStyle = 'cyan';
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  ctx.fill();
}

function pointLineDistance(px, py, x1, y1, x2, y2) {
  const A = px - x1;
  const B = py - y1;
  const C = x2 - x1;
  const D = y2 - y1;

  const dot = A * C + B * D;
  const lenSq = C * C + D * D;
  let param = dot / lenSq;

  if (param < 0) param = 0;
  else if (param > 1) param = 1;

  const xx = x1 + param * C;
  const yy = y1 + param * D;
  const dx = px - xx;
  const dy = py - yy;

  return { dist: Math.sqrt(dx * dx + dy * dy), nx: xx, ny: yy };
}

function updatePlayer() {
  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;
  player.onRamp = false;

  for (const ramp of ramps) {
    const { dist, nx, ny } = pointLineDistance(player.x, player.y, ramp.x1, ramp.y1, ramp.x2, ramp.y2);
    if (dist < player.radius) {
      player.onRamp = true;
      // Przyklejenie do rampy
      player.y = ny - (player.radius - dist);
      // Wyrównanie ruchu wzdłuż rampy
      const angle = Math.atan2(ramp.y2 - ramp.y1, ramp.x2 - ramp.x1);
      player.vx = Math.cos(angle) * player.vx * friction;
      player.vy = Math.sin(angle) * player.vx;
    }
  }

  if (player.y > canvas.height) {
    reset();
  }
}

function reset() {
  player.x = 100;
  player.y = 100;
  player.vx = 2;
  player.vy = 0;
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ramps.forEach(drawRamp);
  drawPlayer();
}

function loop() {
  updatePlayer();
  draw();
  requestAnimationFrame(loop);
}

window.addEventListener('keydown', e => {
  if (e.code === 'Space' && player.onRamp) {
    player.vy = player.jumpPower;
  }
});

loop();
</script>
</body>
</html>
